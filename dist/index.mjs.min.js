function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function i(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||c(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function a(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(Object(r),!0).forEach((function(e){o(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=c(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function c(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)
/*!
 * @dgteam/dgx-pinia v0.1.0
 * @author 2681137811 <donguayx@qq.com> 
 * @license MIT
 */}function f(t,e){if(null==t||"function"!=typeof e)return!1;var r=e.prototype;for(t=t.__proto__;r;){if(null===t)return!1;if(r===t)return!0;t=t.__proto__}}function p(t){return JSON.parse(JSON.stringify(t))}function y(t){return Array.isArray?Array.isArray(t):"[object Array]"===(e=t,Object.prototype.toString.call(e));var e}function m(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,e="",r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=0;i<=16;i++){var n=Math.random()*t|0;e+=r[n]}return e}function d(){for(var t,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];(t=console).warn.apply(t,["[dgx-pinia]"].concat(r))}var h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};console.log("FETCH",this),"string"==typeof e&&(e={url:e});var r=e,i=r.method,n=void 0===i?"GET":i,o=r.silent,c=r.only,l=e.table&&this[e.table]&&f(this[e.table],S)?this[e.table]:null,h=function(){l&&(t.composition.set(l,"loading",!!l.fetchs.find((function(t){return"GET"===t.method}))),t.composition.set(l,"editing",!!l.fetchs.find((function(t){return~["POST","PUT","DELETE"].indexOf(t.method)}))))},v=function(t){l&&l.fetchs&&l.fetchs.forEach((function(e,r){if(t(e,r)){try{e.cancel({table:l,only:c})}catch(t){d("need cancelHandler.")}l.fetchs.splice(r,1),h()}}))},b=function(e){switch(t.httpClientType){case"axios":default:return e;case"uniapp":var r=p(e);if(r.headers&&"object"===u(r.headers)&&(r.header=p(r.headers),delete r.headers),r.params&&"object"===u(r.params))for(var i in-1===r.url.indexOf("?")&&(r.url+="?"),r.params)void 0!==r.params[i]&&("string"==typeof r.params[i]||"number"==typeof r.params[i]?r.url+="".concat(i,"=").concat(r.params[i],"&"):r.url+="".concat(i,"=").concat(JSON.stringify(r.params[i]),"&"));return r}};c&&v((function(t){return t.only===c})),e.headers||(e.headers={});var g,O=[],j=s(e.url.split("/"));try{for(j.s();!(g=j.n()).done;){var P=g.value;if(":"===P[0]&&P.length>1){var K=P.substr(1);e.paths&&void 0!==e.paths[K]&&"function"==typeof e.paths[K].toString?O.push(e.paths[K].toString()):e.params&&void 0!==e.params[K]&&"function"==typeof e.params[K].toString?O.push(e.params[K].toString()):O.push("")}else O.push(P)}}catch(t){j.e(t)}finally{j.f()}return e.url=O.join("/"),new Promise((function(r){var i=m(16),s=function(n){if("uniapp"===t.httpClientType&&y(n)&&2===n.length){var o=n[1],s=o.data,c=o.header,u=o.statusCode;n={config:e,status:u,headers:c,data:s}}v((function(t){return t.id===i})),l&&(l.init=!0,l.error=!1),"string"==typeof e.responseType&&"arraybuffer"===e.responseType.toLowerCase()?r({data:n.data,config:Object.assign({},e,n.config)}):r(a(a({},n.data),{},{config:Object.assign({},e,n.config)}))},u=function(t){v((function(t){return t.id===i})),l&&(l.error=!0),r(a(a({},t.data),{},{config:Object.assign({},e,t.config)}))};if(t.httpClient){l&&l.fetchs&&(l.fetchs.push({id:i,table:l,only:c,method:n,silent:o}),h());var f=b(e);return t.httpClient(a({getCancel:function(e,r){if(l){var n=l.fetchs.find((function(t){return t.id===i}));n&&(t.composition.set(n,"requestId",e),t.composition.set(n,"cancel",r))}}},f)).then(s,u)}d("need httpClient")}))},v=function(t,e,r){var i=this;console.log("RESTFUL 1",this),"object"===u(e)&&e.name&&(e=this[e.name]),"string"==typeof e&&(e=this[e]);var n=Object.assign({action:"GET"},r).action;r.primaryKey&&(r.primaryKey=t.primaryKey);var o={GET:"GET",MORE:"GET",POST:"POST",PUT:"PUT",PATCH:"PATCH",DELETE:"DELETE"}[n];if(e&&o){var s=e.options,c=function(e){var i=!1;return"string"==typeof e&&(void 0!==r[e]?i=r[e]:s[o]&&void 0!==s[o][e]?i=s[o][e]:void 0!==s[e]?i=s[e]:"object"===u(t.defaultConfig)&&"object"===u(t.defaultConfig[o])&&void 0!==t.defaultConfig[o][e]&&(i=t.defaultConfig[o][e]),!0===i&&"only"===e&&(i=o)),"function"==typeof i&&(i=i(data,s,Model)),i},l=a(a({},r),{},{method:o,table:r.table,url:"".concat(s.url).concat(r.id?"/"+r.id:""),data:r.data||{},params:r.params||{},paths:r.paths||{},headers:r.headers||{},limit:c("limit")||{},only:c("only"),silent:c("silent"),loading:c("loading"),customData:c("customData")});if("object"===u(l.limit))for(var f in l.limit)for(var m=0,d=["params","paths","data"];m<d.length;m++){var v=d[m];("GET"===o&&"params"===v||"GET"!==o&&"data"===v||"paths"===v)&&(l[v][f]=l.limit[f])}"MORE"===n&&(void 0!==e.marker?l.params.marker=e.marker:(console.log("MORE",{fetchData:l,table:e}),l.params.page=e.page+1));var K={update:function(r,n){return b.call(i,t,e,r,n)},rows:{add:function(r,n){return g.call(i,t,e,r,n)},update:function(n){return O.call(i,t,e,n,r)},merge:function(r){return j.call(i,t,e,r)},remove:function(i){if(i&&"object"===u(i))try{i=i[r.primaryKey]}catch(t){}return P.call(this,t,e,i,r)}}},T={GET:function(t){var e=c("interact");if(r.id)e&&K.update("item",t.result);else if(y(t.result)){e&&("MORE"===n?K.rows.merge(t.result):K.update("list",t.result));var i=t.page||r.params&&r.params.page||1,a=void 0!==t.marker?t.marker:void 0,o=null!=t.count&&t.count>=0?Number(t.count):void 0,s=t.total,l=!(1!=t.page||t.result.length),u=t.page<t.total,f=r.params?p(r.params):{};K.update({page:i,marker:a,count:o,total:s,empty:l,more:u,filter:f})}else e&&K.update("list",t.result||t)},POST:function(t){var i=c("interact");if(i&&t.result&&t.result[r.primaryKey]){var n="end";"object"===u(i)&&i.position?n=i.position:("number"==typeof i||~["start","begin","head","end","finish","foot","last"].indexOf(i))&&(n=i),K.rows.add(t.result,n),null!=e.count&&e.count>=0&&K.update("count",e.count+1),e.empty&&K.update("empty",!1)}},PUT:function(t){c("interact")&&t.result&&t.result[r.primaryKey]&&K.rows.update(t.result)},DELETE:function(t){c("interact")&&(K.rows.remove(r.id),e.item&&e.item[r.primaryKey]===r.id&&K.update({active:null,item:null}),null!=e.count&&e.count>0&&K.update({count:e.count-1}),1===e.page&&0===e.list.length&&K.update({empty:!0,more:!1}))}};return T.PATCH=T.PUT,h.call(this,t,l).then((function(t){return t&&t.result&&T[o](t),t}))}return Promise.resolve({err:1})},b=function(t,e,r,i){if(console.log("TABLE_UPDATE",this,{table:e,key:r,value:i}),"string"==typeof r)t.composition.set(e,r,i);else if("object"===u(r)&&null!==r)for(var n in r)t.composition.set(e,n,r[n])},g=function(t,e,r,i){"string"==typeof i&&(i=~["start","begin","head"].indexOf(i)?0:~["end","foot","last"].indexOf(i)?-1:parseInt(i)),0===i?e.list.unshift(r):-1===i?e.list.push(r):Number.isInteger(i)&&e.list.splice(i,0,r)},O=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{if(i.primaryKey||(i.primaryKey=t.primaryKey),r[i.primaryKey]){var n,a=s(e.list);try{for(a.s();!(n=a.n()).done;){var o=n.value;o[i.primaryKey]&&o[i.primaryKey]===r[i.primaryKey]&&Object.assign(o,r)}}catch(t){a.e(t)}finally{a.f()}if(e.item){var c=e.item;c[i.primaryKey]&&c[i.primaryKey]===r[i.primaryKey]&&Object.assign(c,r)}}}catch(t){}},j=function(t,e,r){var n;(n=e.list).push.apply(n,i(r))},P=function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i.primaryKey||(i.primaryKey=t.primaryKey),r&&"object"===u(r)&&(r=r[i.primaryKey]);var n=r?e.list.findIndex((function(t){return t[i.primaryKey]===r})):void 0;n>=0&&e.list.splice(n,1)},K=function(t,e,r){for(var i=0,n=["active","item"];i<n.length;i++){var a=n[i];(r[a]||0==r[a])&&b(t,e,a,r[a])}return r.item},T=function(t,e){for(var r=0,i=["active","item"];r<i.length;r++){b(t,e,i[r],void 0)}},E=function(){function e(r){t(this,e);var i=Object.assign({primaryKey:"id",defaultConfig:{GET:{interact:!0},POST:{interact:!1},PUT:{interact:!0},PATCH:{interact:!0},DELETE:{interact:!0}},httpClient:null,httpClientType:"axios",enable:!0},r),n=r&&r.composition||{},a=n.set,o=n.ref,s=n.reactive,c=n.isRef,l=n.isProxy;this.composition={set:a,ref:o,reactive:s,isRef:c,isProxy:l},this.composition.set&&"function"==typeof this.composition.set||(this.composition.set=function(t,e,r){c(t.key)?t.key.value=r:t[e]=r}),this.id=m(16),this.isDev="development"===process.env.NODE_ENV,this.version="0.1.0",this.primaryKey=i.primaryKey,this.defaultConfig=i.defaultConfig,this.httpClient=i.httpClient,this.httpClientType=i.httpClientType,this.enable=i.enable}return r(e,[{key:"createPiniaPlugin",value:function(){if(!this.enable)return new Function;var t=this.isDev,e=this,r=this.composition,i=r.set;r.reactive;return function(r){r.pinia,r.app;var n=r.store,a=r.options;a.tables&&Object.keys(a.tables).forEach((function(r){var o=new S(r,a.tables[r],e,n);t&&(i(n.$state,r,o),void 0!==n._customProperties&&n._customProperties.add(r)),i(n,r,o)})),i(n,"FETCH",(function(t){return h.call(this,e,t)}))}}}]),e}(),S=function(){function e(r,i,n,s){var c=this;t(this,e),n.composition,"string"==typeof i&&(i={url:i});var l=Object.assign({name:""},{name:r},i);this.name=l.name,this.init=!1,this.error=!1,this.loading=!1,this.editing=!1,this.fetchs=[],this.page=1,this.total=void 0,this.count=void 0,this.empty=!1,this.filter={},this.list=[],this.marker=void 0,this.next=void 0,this.active=void 0,this.item=void 0,this.sync_at=void 0;var f=this;Object.defineProperty(this,"client",{get:function(){return n}}),Object.defineProperty(this,"options",{get:function(){return l}});Object.defineProperty(this,"get",{value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===u(t)&&(r=e=t,t=1);var i=p(e||{});return i.page=t||1,r.clean&&f.reset(),v.call(this,n,f,a(a({},r),{},{action:"GET",table:f.name,params:i}))}.bind(s)});var m=function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.cache,o=r.strict,s=r.immediate,c=r.clean,l=!this.init||Boolean(s);"object"!==u(t)&&(t={});var y=function(){c&&e.reset();var i=p(t||{});return v.call(e,n,f,a(a({},r),{},{action:"GET",table:e.name,params:i})).then((function(r){return r.err?a(a({},r),{},{result:[],filter:t,fetch:!0}):(n.composition.set(e,"sync_at",new Date),a(a({},r),{},{filter:t,fetch:!0}))}))};if(0===this.list.length)l=!0;else if("number"==typeof i&&this.sync_at&&!l){var m=new Date(this.sync_at).getTime(),h=m+1e3*i;l=Date.now()>h}else if(o)try{l=JSON.stringify(this.filter)!==JSON.stringify(t)}catch(t){d("getInit: filter is invalid.")}return l?y():Promise.resolve({err:0,msg:"cache data",result:this.list,filter:this.filter,fetch:!1})};Object.defineProperty(this,"getInit",{value:function(t){return m.bind(s)}}),Object.defineProperty(this,"getFilter",{value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return void 0===e.clean&&(e.clean=!0),c.get(1,t,e)}});Object.defineProperty(this,"getItem",{value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"===u(t)&&(r.primaryKey||(r.primaryKey=n.primaryKey),t=t[r.primaryKey]);var i=p(e||{});return v.call(this,n,f,a(a({},r),{},{action:"GET",id:t,table:f.name,params:i}))}.bind(s)});Object.defineProperty(this,"getMore",{value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=f.init,i=f.loading,o=f.more,s=f.empty;if(r&&!i&&o&&!s){var c=p(t||{});return v.call(this,n,f,a(a({},e),{},{action:"MORE",table:f.name,params:c}))}return Promise.resolve(null)}.bind(s)});Object.defineProperty(this,"build",{value:function(t,e){var r=this[f.name];return g(n,r,t,e)}.bind(s)});Object.defineProperty(this,"save",{value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this[f.name];return O(n,r,t,e)}.bind(s)});Object.defineProperty(this,"remove",{value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this[f.name];return P(n,r,t,e)}.bind(s)});var h=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return v.call(this,n,f,a(a({},e),{},{action:"POST",table:f.name,data:t}))};Object.defineProperty(this,"create",{value:h.bind(s)}),Object.defineProperty(this,"post",{value:h.bind(s)});var b=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.primaryKey||(e.primaryKey=n.primaryKey),v.call(this,n,f,a(a({},e),{},{action:"PUT",id:t[e.primaryKey],table:f.name,data:t}))};Object.defineProperty(this,"update",{value:b.bind(s)}),Object.defineProperty(this,"put",{value:b.bind(s)});Object.defineProperty(this,"patch",{value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.primaryKey||(e.primaryKey=n.primaryKey),v.call(this,n,f,a(a({},e),{},{action:"PATCH",id:t[e.primaryKey],table:f.name,data:t}))}.bind(s)});var j=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.primaryKey||(e.primaryKey=n.primaryKey),v.call(this,n,f,a(a({},e),{},{action:"DELETE",id:t[e.primaryKey],table:f.name,data:t}))};Object.defineProperty(this,"destroy",{value:j.bind(s)}),Object.defineProperty(this,"delete",{value:j.bind(s)}),Object.defineProperty(this,"submit",{value:function(t,e){return e.primaryKey||(e.primaryKey=n.primaryKey),t[e.primaryKey]?c.put(t,e):c.post(t,e)}});Object.defineProperty(this,"check",{value:function(t){var e=this[f.name];return function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(y(r)&&r[0]&&(r=r[0]),null==r)T(t,e);else if("object"===u(r)){var n=r,a=e.list;i.primaryKey||(i.primaryKey=t.primaryKey);for(var s=0;s<a.length;s++){var c;if(n[i.primaryKey]&&a[s][i.primaryKey]&&a[s][i.primaryKey]===n[i.primaryKey])return K(t,e,(o(c={},i.primaryKey,a[s][i.primaryKey]||void 0),o(c,"active",s),o(c,"item",a[s]),c))}}else{-1==r&&(r=e.list.length>0?e.list.length-1:0);for(var l,f=[r,e.active,0],p=0;p<f.length;p++)if(e.list[f[p]]){r=f[p];break}if(e.list&&e.list[r])return i.primaryKey||(i.primaryKey=t.primaryKey),K(t,e,(o(l={},i.primaryKey,e.list[r][i.primaryKey]),o(l,"active",r),o(l,"item",e.list[r]),l));ACTIVE_TABLE_RESET()}}(n,e,t)}.bind(s)});return Object.defineProperty(this,"reset",{value:function(){var t=this[f.name];n.composition.set(t,"init",!1),n.composition.set(t,"error",!1),n.composition.set(t,"page",1),n.composition.set(t,"total",void 0),n.composition.set(t,"count",void 0),n.composition.set(t,"empty",!1),n.composition.set(t,"filter",{}),n.composition.set(t,"list",[]),n.composition.set(t,"marker",void 0),n.composition.set(t,"next",void 0),n.composition.set(t,"active",void 0),n.composition.set(t,"item",void 0)}.bind(s)}),this.opt}return r(e,[{key:"toJSON",value:function(){return t=this,Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),{});var t}}]),e}(),w="0.1.0",C=E,A={version:"0.1.0",dgx:C,DgxClient:E};export{E as DgxClient,A as default,C as dgx,w as version};
